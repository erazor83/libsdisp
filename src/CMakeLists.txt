CMAKE_MINIMUM_REQUIRED(VERSION 2.6)
PROJECT(LIBSDSP)


SET(LIBSDSP_VERSION_MAJOR 1)
SET(LIBSDSP_VERSION_MINOR 1)
SET(LIBSDSP_VERSION_MICRO 3)


BUS_LIBS=i2c
DISPLAY_LIBS=ssd1306

FOREACH(b ${BUS_LIBS}) 
  BUS_FILES="${BUS_FILES} ${b}.c"
ENDFOREACH(f)

FOREACH(d ${DISPLAY_LIBS}) 
  DISPLAY_FILES="${DISPLAY_LIBS} ${d}.c"
ENDFOREACH(f)

CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/sdsp_config.h.in ${CMAKE_CURRENT_BINARY_DIR}/sdsp_config.h)

SET(CMAKE_C_FLAGS "-I ${CMAKE_CURRENT_SOURCE_DIR} -I bus/i2c/ -I display/ -g -Wall")
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR}) # for generated config.h

MESSAGE(STATUS "libsdsp C_FLAGS: ${CMAKE_C_FLAGS}")



ADD_LIBRARY(sdsp sdsp.c ${BUS_FILES} ${DISPLAY_FILES})

IF (WITH_SHARED)
	ADD_LIBRARY(sdsp_shared SHARED sdsp.c ${BUS_FILES} ${DISPLAY_FILES})
ENDIF(WITH_SHARED)


INSTALL (FILES sdsp.h sdsp-version.h ${CMAKE_CURRENT_BINARY_DIR}/sdsp_config.h
	DESTINATION include
)
INSTALL (TARGETS sdsp
	LIBRARY DESTINATION lib
	ARCHIVE DESTINATION lib
)

IF (WITH_SHARED)
	INSTALL (TARGETS sdsp_shared
		LIBRARY DESTINATION lib
		ARCHIVE DESTINATION lib
	)
ENDIF (WITH_SHARED)


